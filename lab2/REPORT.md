#№ Отчет по лабораторной работе №2
## по курсу "Логическое программирование"

## Решение логических задач

### студент: Тарпанов Д.А.

## Результат проверки

| Преподаватель     | Дата         |  Оценка       |
|-------------------|--------------|---------------|
| Сошников Д.В. |              |               |
| Левинская М.А.|              |       5-      |

> *Комментарии проверяющих (обратите внимание, что более подробные комментарии возможны непосредственно в репозитории по тексту программы)*


## Введение

Существует несколько подходов к решению логических задач. Первый, и самый понятный, основывается на переборе всех вариантов решений (правильных и неправильных), которые будут отсеиваться по ходу проверок. Отсеивание происходит благодаря определению так называемых противоречий, т.е. для каждого конкретного решения проверяется, нет ли в нем условий, противоречащих исходным данным. Самой сложной частью данного метода является написание данных критериев противоречия. Они должны быть достаточно полными, чтобы не появлялось лишних и неправильных ответов. Второй подход базируется на предварительном ограничении вариантов решений. В таком подходе генерируется подмножество множества решений. Очевидно, что подходов к решению логических задач гораздо больше. Например, можно создавать комбинации различных идей для улучшения эффективности программы.
Пролог очень удобен для логических задач в связи с существованием механизма бэктрекинга. Если при рассмотрении полученного варианта решения оказывается, что оно неправильно, то происходит возврат и ответ ищется заново.

## Задание

Воронов, Павлов, Левицкий и Сахаров четыре талантливых молодых человека. Один из них танцор, другой художник, третий певец, четвертый писатель. Воронов и Левицкий сидели в зале консерватории в тот вечер, когда певец дебютировал в сольном концерте. Павлов и писатель вместе позировали художнику. Писатель написал биографическую повесть о Сахарове и собирается написать о Воронове. Воронов никогда не слышал о Левицком. Кто чем занимается?

## Принцип решения

Для решения данной задачи используется метод перебора вариантов. С помощью стандартного предиката permutation генерируются варианты решений, которые проверяются на отсутствие противоречий. Рассмотрим механизм определения противоречий. По условию задачи есть 3 условных события -- концерт, рисование и написание биографической повести. Первый этап отсеивания заключается в том, что человек не мог присутствовать на одном из этих событий дважды. То есть, если Левицкий и Воронов были на концерте певца, певцами они быть не могут:

```prolog
event(concert, [levitskiy, voronov, singer]).
event(art, [pavlov, writer, artist]).
event(biography, [writer, saharov, voronov]).

event_contradiction(Person, Job) :-
    event(_, X),
    member(Person, X), member(Job, X), 
    !.
```

Предикат возвращает true, в случае, если противоречие есть.

Второй этап отсеивания строится на фактах о знакомстве. Исходя из условия задачи, я решил, что можно быть уверенным лишь в том, что Павлов, писатель и художник знакомы между собой, а Воронов и Левитский незнакомы. Из этого следует второе противоречие -- Два человека не могут быть знакомы и незнакомы одновременно. То есть, если Левицкий и Воронов незнакомы, то они не могут быть одновременно художником и писателем:

```prolog
unfamiliar([levitskiy, voronov]).
familiar([pavlov, writer]).
familiar([pavlov, artist]).
familiar([writer, artist]).

familiarity_contradiction(P1, J1, P2, J2) :-
    unfamiliar(X),
    member(P1,X), member(P2, X),
    familiar(Y),
    member(J1, Y), member(J2, Y),
    !.
```

В идее данного противоречия было сделано небольшое ухищрение, которое, вероятно, можно назвать "додумыванием". Раз Левинский и Воронов незнакомы, и других фактов об их знакомстве нет, то будем проверять лишь условие того, что они не являются художником и писателем одновременно. Предикат возвращает true, если найдено противоречие.

Используя данные проверки определяется предикат отсеивания вариантов для ответа, представляемого в виде списка. Для каждого человека он определяет наличие противоречия события, для каждой пары наличие противоречия знакомства. Далее вызывается рекурсия на хвост списка:

```prolog
list_contradiction([], []).

list_contradiction([P,P1|P2], [J,J1|J2]) :-
    not(event_contradiction(P, J)),
    not(event_contradiction(P1, J1)),
    not(familiarity_contradiction(P, J, P1, J1)),
    !,
    list_contradiction(P2, J2).
```

В случае наличия противоречия предикат возвращает false.

Предикат, решающий задачу, выглядит следующим образом:

```prolog
solve(Lev, Vor, Pav, Sah) :-
    permutation([dancer, singer, writer, artist], [Lev, Vor, Pav, Sah]),   
    list_contradiction([levitskiy, voronov, pavlov, saharov], [Lev, Vor, Pav, Sah]).
```

Генерируются перестановки списка занятий, после чего идет проверка на противоречия.

Результат вызова предиката:

```prolog
?- solve(Levitskiy, Voronov, Pavlov, Saharov).
Levitskiy = writer,
Voronov = dancer,
Pavlov = singer,
Saharov = artist ;
false.
```

Здесь writer -- писатель, dancer -- танцор, singer -- певец и artist -- художник. Видно, что решение единственно и не противоречиво.

## Выводы

После выполнения первой лабораторной работы казалось, что я понял основные идеи и подходы к программированию на Прологе, и остальные лабораторные работы будут не такими сложными. На деле все вышло совсем не так. Приступив к выполнению данного задания, я столкнулся с огромным количеством проблем. Если на лекциях все алгоритмы решения задач были понятны, то в момент начала написания кода я вообще не знал с какой стороны подступить. Во время работы я попробовал минимум 3 различных подхода, из которых только последний привел меня к правильному ответу. Немного поломав голову, мною было принято решение начать разработку ограничений по частям. Целью первого предиката event_contradiction был вывод непротиворечивых ответов для данных о событиях. Отладив и получив список правильных ответов, я приступил к разработке предиката familiarity_contradiction. Когда он заработал, я объединил получившиеся предикаты event_contradiction и familiarity_contradiction в предикат list_contradtiction, который в качестве аргументов получал список персон и профессий. После этого оставалось лишь написать предикат solve, который генерировал бы варианты и выбирал непротиворечивые.
В очередной раз лабораторная работа по логическому программированию сломала мне мозг, и в очередной раз мне кажется что сложнее уже не будет. Сама идея кода является условной копией хода решения этой же задачи моими руками. Огромной проблемой было представить факты о знакомстве в качестве предиката отсеивания вариантов, ведь, при решении вручную, факт того, что Левитский и Воронов не могут быть художником и писателем одновременно, является самым неявным фактом. Сложностная оценка: алгоритм генерирует все варианты решения, потом происхдит проверка для всех вариантов. В связи с этим получаем сложностную оценку: O(n!), n по условию задачи 4.




